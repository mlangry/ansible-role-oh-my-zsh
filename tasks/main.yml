---
- name: Install oh-my-zsh
  git:
    repo: https://github.com/robbyrussell/oh-my-zsh.git
    dest: "{{ oh_my_zsh_path }}"
    update: yes
  become: yes
  become_user: "{{ item.user | default(item) }}"
  with_items: "{{ oh_my_zsh_users }}"

- name: Create configuration file
  copy:
    src: "{{ item.zsh_rc_file_path | default( oh_my_zsh_path ~ '/templates/zshrc.zsh-template' ) }}"
    dest: "{{ oh_my_zsh_rc_file_path }}"
    remote_src: "{{ item.zsh_rc_file_path is not defined }}"
    backup: yes
  become: yes
  become_user: "{{ item.user | default(item) }}"
  with_items: "{{ oh_my_zsh_users }}"
